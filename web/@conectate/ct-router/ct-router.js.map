{"version":3,"file":"ct-router.js","sourceRoot":"","sources":["src/ct-router.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, customElement, html } from 'lit-element';\nimport { unsafeHTML } from 'lit-html/directives/unsafe-html';\nimport { installRouter } from 'pwa-helpers/router';\n\nimport { C2Regexp, C2RegexpType, EvaluateParams } from './path_to_regexp';\n\nexport interface Page {\n\tpath: string;\n\telement: any;\n\tfrom: () => any;\n\tauth: boolean | null;\n\ttitle: (() => string) | (() => null);\n\tregex?: RegExp;\n\tgroups?: string[];\n\t[x: string]: any;\n}\n\nexport interface Routes {\n\tpath: string;\n\telement: string;\n\tc2regexp: C2RegexpType;\n\tfrom: () => any;\n\tauth: boolean | null;\n\ttitle: (() => string) | (() => null);\n}\n\ndeclare global {\n\tinterface HTMLElementTagNameMap {\n\t\t'ct-router': CtRouter;\n\t}\n}\n/**\n * @event login-needed It triggers when a page requires authentication but the user is not yet logged in\n * @event loading It fires when a page is imported diamicamente and it is fired again when it finishes loading the page\n * @event location-changed it shoots when the route changes\n */\n@customElement('ct-router')\nexport class CtRouter extends LitElement {\n\t$: { [x: string]: HTMLElement | any } = {};\n\t_routes: { [x: string]: Routes } = {};\n\t_currentView: any = '';\n\tpages: Page[] = [];\n\tpatternMatched: string = '';\n\tpathname: string = '/';\n\tqueryParams: { [x: string]: string } = {};\n\tparams: { [x: string]: string } = {};\n\tauth: boolean = false;\n\tloginFallback = '/login';\n\n\trender() {\n\t\treturn html`<style>\n\t\t\t\t:host {\n\t\t\t\t\tdisplay: block;\n\t\t\t\t}\n\t\t\t\t@keyframes fadeEffect {\n\t\t\t\t\tfrom {\n\t\t\t\t\t\topacity: 0;\n\t\t\t\t\t}\n\t\t\t\t\tto {\n\t\t\t\t\t\topacity: 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t#content {\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tmin-height: 100%;\n\t\t\t\t}\n\t\t\t\t#content > * {\n\t\t\t\t\tanimation: fadeEffect 0.5s;\n\t\t\t\t\tmin-height: 100%;\n\t\t\t\t}\n\t\t\t</style>\n\t\t\t<slot id=\"drawerSlot\" name=\"banner\"></slot>\n\n\t\t\t<div id=\"content\">${typeof this._currentView == 'string' ? unsafeHTML(this._currentView) : this._currentView}</div> `;\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\t\t// @ts-ignore\n\t\twindow.ctrouter = this;\n\t\tinstallRouter((l) => this.handleRoutes(l));\n\t\twindow.addEventListener('location-changed', () => this.handleRoutes(window.location));\n\t}\n\n\tupdated(_changedProperties: Map<PropertyKey, unknown>) {\n\t\tsuper.updated(_changedProperties);\n\t\tif (_changedProperties.has('pages')) {\n\t\t\tthis._contentAdded(this.pages);\n\t\t}\n\t}\n\n\t/**\n\t *\n\t * @param data {Object}\n\t * @param title {String}\n\t * @param url {string | null}\n\t */\n\treplaceState(data: object, title: string, url: string) {\n\t\twindow.history && window.history.replaceState(data, title, url);\n\t\tthis._setPath(url);\n\t}\n\n\thandleRoutes(location: Location) {\n\t\t/*\n        Esto es por si hago un push state y luego hago un back entonces no cambie la URL\n        ej: /herberth -> /herberth#showDialog -> /herberth\n        */\n\t\tif (location.pathname != this.pathname) {\n\t\t\tthis._setPath(location.pathname);\n\t\t\tthis._setQueryParams(getQueryParams());\n\t\t\tthis._pathChanged(this.pathname);\n\t\t}\n\t}\n\n\tstatic get properties() {\n\t\treturn {\n\t\t\t/**\n\t\t\t * Array de elementos {path,element(HTML),from,auth,title}\n\t\t\t */\n\t\t\tpages: { type: Array },\n\t\t\t/**\n\t\t\t * Parametro para verificar el auto\n\t\t\t */\n\t\t\tauth: { type: Boolean },\n\t\t\t/**\n\t\t\t * Comes from app-location. The current most important parts here\n\t\t\t * are `path` and `__queryParams` which sets the `path` and `queryParams`\n\t\t\t * of this element respectively.\n\t\t\t */\n\t\t\t_route: { type: Object },\n\n\t\t\t/**\n\t\t\t * The current path of the app. Changes depending on the URL put at the top\n\t\t\t * or pushed in the state of the browser\n\t\t\t */\n\t\t\tpath: { type: String },\n\n\t\t\t/**\n\t\t\t * This is an object that holds the values of the parameters in the route\n\t\t\t * pattern set in the current page element being viewed.\n\t\t\t */\n\t\t\tparams: { type: Object },\n\n\t\t\t/**\n\t\t\t * This is an object that holds the values of the query parameters in the url\n\t\t\t */\n\t\t\tqueryParams: { type: Object },\n\n\t\t\t/**\n\t\t\t * This is required. This is the tag-name of the element that holds\n\t\t\t * the list of page elements that will need to be lazy-loaded.\n\t\t\t */\n\t\t\tparentTagName: { type: String },\n\t\t\t/**\n\t\t\t * This is for iron-selected navigation lists\n\t\t\t */\n\t\t\tcurrentRoute: { type: String },\n\t\t\t/**\n\t\t\t * This holds the current route that is being viewed\n\t\t\t */\n\t\t\t_currentView: { type: Object },\n\n\t\t\t/**\n\t\t\t * This holds the next route to be viewed after the url has been changed.\n\t\t\t */\n\t\t\tpatternMatched: { type: String },\n\t\t\t/**\n\t\t\t * This will be the registered element that holds all the source files of the\n\t\t\t * elements that needed to be lazy-loaded.\n\t\t\t */\n\t\t\t_fromElement: { type: Object },\n\n\t\t\t/**\n\t\t\t * This is a dictionary of routes linked to its corresponding elements.\n\t\t\t */\n\t\t\t_routes: { type: Object }\n\t\t};\n\t}\n\n\t/**\n\t * Sets the path property\n\t */\n\t_setPath(path: string) {\n\t\tthis.pathname = path || '/';\n\t}\n\n\t/**\n\t * Sets the queryParams property and updates the element's params and queryParams\n\t * properties. It also calls the page element's updateView method if it exists\n\t */\n\t_setQueryParams(queryParams: { [x: string]: string }) {\n\t\tthis.queryParams = queryParams || {};\n\t}\n\n\t/**\n\t * Called in the attached lifecycle method to put the children to the dictionary\n\t * for easy referencing\n\t */\n\t_contentAdded(pages: Page[]) {\n\t\tfor (let el of pages) {\n\t\t\tif (el && el.path) {\n\t\t\t\tlet c2regexp: C2RegexpType;\n\t\t\t\t// Custom regex and keys\n\t\t\t\tif (el.regex != null && el.groups != null) {\n\t\t\t\t\t// regex : expresion regular\n\t\t\t\t\t// keys : Array(0)\n\t\t\t\t\tlet regex = new RegExp(el.regex, 'i');\n\t\t\t\t\tc2regexp = { regexp: regex, groups: el.groups };\n\t\t\t\t} else {\n\t\t\t\t\tc2regexp = C2Regexp(el.path);\n\t\t\t\t}\n\t\t\t\tif (!this._routes[el.path]) {\n\t\t\t\t\tthis._routes[el.path] = {\n\t\t\t\t\t\tpath: el.path,\n\t\t\t\t\t\telement: el.element,\n\t\t\t\t\t\tc2regexp: c2regexp,\n\t\t\t\t\t\tfrom: el.from,\n\t\t\t\t\t\tauth: el.auth,\n\t\t\t\t\t\ttitle: el.title\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\tconsole.warn(new Error(`The Path: '${el.path}' already use`));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// cuando termina de agregar nuevo contenido entonces acciono el pathChanged para ver si hay un mejor match\n\t\tthis._pathChanged(this.pathname);\n\t}\n\n\t/**\n\t * Here is the magic! This is called when the path changes. It tries to look for a the pattern\n\t * that matches the path, then calls the _changeView method to change the view\n\t */\n\t_pathChanged(path: string) {\n\t\tlet routes = this._routes;\n\t\tlet patternMatched: any = null;\n\t\tthis.params = {};\n\t\tlet routePaths = this.pages;\n\t\tif (routePaths.length == 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i = 0; i < routePaths.length; i++) {\n\t\t\tlet element = routes[routePaths[i].path]; // element,c2regexp,from,auth\n\t\t\t// console.log(routePaths[i].path,element.c2regexp.regexp);\n\t\t\tlet c2 = EvaluateParams(path, element.c2regexp);\n\t\t\tif (c2 != null) {\n\t\t\t\t// Set params like a  {username : \"herberthbregon\", \"jid\" : 1234}\n\t\t\t\tthis.params = c2;\n\t\t\t\tpatternMatched = routePaths[i].path;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// if pattern matched is created, change the view, if exausted all\n\t\t// route patterns, make view a not-found\n\t\t//console.log(patternMatched);\n\t\tif (patternMatched) {\n\t\t\t// Si la vista es protegida y no esta logeado entonces lo mando a /login y no esta autenticado\n\t\t\tif (routes[patternMatched].auth && !this.auth) {\n\t\t\t\tthis.patternMatched = patternMatched = this.loginFallback;\n\t\t\t\tconsole.warn('Se necesita iniciar sesion para realizar esta accion');\n\t\t\t\tthis.fire('login-needed', { path: window.location.pathname });\n\t\t\t\tthis._currentView = this._routes[this.loginFallback].element;\n\t\t\t} else {\n\t\t\t\tthis.patternMatched = patternMatched;\n\t\t\t\tthis._currentView = this._routes[patternMatched].element;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.patternMatched = patternMatched = '/404';\n\t\t\tconsole.log('/404');\n\t\t\tthis._currentView = this._routes['/404'].element;\n\t\t}\n\n\t\tthis.fire('location-changed', {\n\t\t\tpath: patternMatched,\n\t\t\tpathname: this.pathname,\n\t\t\tqueryParams: this.queryParams,\n\t\t\tparams: this.params\n\t\t});\n\t\tif (patternMatched && routes[patternMatched]) {\n\t\t\tlet fromImport = routes[patternMatched].from;\n\t\t\tif (fromImport) {\n\t\t\t\tthis.fire('loading', true);\n\t\t\t\tfromImport()\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tthis.fire(patternMatched);\n\t\t\t\t\t\tsetTimeout(() => this.fire('loading', false), 500);\n\t\t\t\t\t})\n\t\t\t\t\t.catch((e: any) => {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\tif (`${e}`.includes('ChunkLoadError')) {\n\t\t\t\t\t\t\tsetTimeout(() => location.reload(), 10000);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconsole.error(\"Can't lazy-import - \" + fromImport);\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tsetTimeout(() => this.fire('loading', false), 800);\n\t\t\t}\n\t\t\tif (routes[patternMatched].title()) {\n\t\t\t\tdocument.title = routes[patternMatched].title() as string;\n\t\t\t}\n\t\t}\n\t}\n\n\tfire(name: string, value?: any) {\n\t\tthis.dispatchEvent(new CustomEvent(name, { detail: value }));\n\t}\n}\n\nexport function href(path: string, name: string = document.title) {\n\twindow.history.pushState({}, name, path);\n\twindow.dispatchEvent(new CustomEvent('location-changed'));\n}\n\n// @ts-ignore\nwindow.href = href;\n\nexport function getCtRouter(): CtRouter {\n\t// @ts-ignore\n\treturn window.ctrouter;\n}\n\nexport function getQueryParams() {\n\tlet pairs = window.location.search.substring(1).split('&'),\n\t\tobj: { [x: string]: any } = {},\n\t\tpair,\n\t\ti;\n\n\tfor (i in pairs) {\n\t\tif (pairs[i] === '') continue;\n\n\t\tpair = pairs[i].split('=');\n\t\tobj[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);\n\t}\n\treturn obj || {};\n}\n"]}